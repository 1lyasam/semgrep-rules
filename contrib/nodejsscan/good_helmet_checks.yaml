rules:
- id: helmet_header_check_csp
  languages:
  - javascript
  message: 'Content Security Policy header is present. More Information: https://helmetjs.github.io/docs/csp/'
  metadata:
    category: security
    cwe: "CWE-16: Configuration"
    deprecate: true
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {contentSecurityPolicy: false}, ...)
  - pattern-either:
    - pattern: |
        helmet({contentSecurityPolicy: {directives: ...}})
    - pattern: |
        helmet.contentSecurityPolicy({directives: ...})
    - pattern: |
        csp({directives: ...})
  severity: WARNING
- id: helmet_header_check_crossdomain
  languages:
  - javascript
  message: 'X-Permitted-Cross-Domain-Policies header set to off. More information:
    https://helmetjs.github.io/docs/crossdomain/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {permittedCrossDomainPolicies: false}, ...)
  - pattern-either:
    - pattern: |
        permittedCrossDomainPolicies()
    - pattern: |
        permittedCrossDomainPolicies({ permittedPolicies: ... })
    - pattern: |
        helmet.permittedCrossDomainPolicies({ permittedPolicies: ... })
    - pattern: |
        helmet({permittedCrossDomainPolicies: { permittedPolicies: ... }})
    - pattern: |
        helmet.permittedCrossDomainPolicies()
  severity: WARNING
- id: helmet_header_check_expect_ct
  languages:
  - javascript
  message: 'Expect-CT header is present. More information: https://helmetjs.github.io/docs/expect-ct/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {expectCt: false}, ...)
  - pattern-either:
    - pattern: |
        expectCt({maxAge: ...,})
    - pattern: |
        helmet.expectCt({maxAge: ...,})
    - pattern: |
        expectCt({enforce: ...,})
    - pattern: |
        hemlet.expectCt({enforce: ...,})
    - pattern: |
        helmet({expectCt: { enforce: ... }})
  severity: WARNING
- id: helmet_header_feature_policy
  languages:
  - javascript
  message: 'Feature-Policy header is present. More information: https://helmetjs.github.io/docs/feature-policy/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {featurePolicy: false}, ...)
  - pattern-either:
    - pattern: |
        featurePolicy(..., {features: ...}, ...)
    - pattern: |
        helmet.featurePolicy(..., {features: ...}, ...)
    - pattern: |
        helmet({featurePolicy: {features: ...}})
  severity: WARNING
- id: helmet_header_frame_guard
  languages:
  - javascript
  message: 'X-Frame-Options header is present. More information: https://helmetjs.github.io/docs/frameguard/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {frameguard: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(hemlet())
    - pattern: |
        helmet.frameguard(...)
    - pattern: |
        frameguard(...)
    - pattern: |
        helmet({frameguard: ...})
  severity: WARNING
- id: helmet_header_dns_prefetch
  languages:
  - javascript
  message: 'X-DNS-Prefetch-Control header is present and DNS Prefetch Control is enabled.
    More information: https://helmetjs.github.io/docs/dns-prefetch-control/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {dnsPrefetchControl: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        helmet.dnsPrefetchControl()
    - pattern: |
        dnsPrefetchControl()
    - pattern: |
        helmet.dnsPrefetchControl({ allow: false })
    - pattern: |
        helmet({dnsPrefetchControl: {allow: false}})
    - pattern: |
        dnsPrefetchControl({ allow: false })
  severity: WARNING
- id: helmet_header_x_powered_by
  languages:
  - javascript
  message: 'Default X-Powered-By is removed or modified. More information: https://helmetjs.github.io/docs/hide-powered-by/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {hidePoweredBy: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        app.disable('x-powered-by')
    - pattern: |
        helmet.hidePoweredBy(...)
    - pattern: |
        hidePoweredBy(...)
    - pattern: |
        helmet({hidePoweredBy: ...})
  severity: WARNING
- id: helmet_header_hsts
  languages:
  - javascript
  message: 'HSTS header is present. More information: https://helmetjs.github.io/docs/hsts/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {hsts: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        helmet.hsts(...)
    - pattern: |
        hsts({ maxAge: ...})
    - pattern: |
        helmet({hsts: ...})
  severity: WARNING
- id: helmet_header_ienoopen
  languages:
  - javascript
  message: 'X-Download-Options header is present. More information: https://helmetjs.github.io/docs/ienoopen/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {ieNoOpen: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        helmet.ieNoOpen()
    - pattern: |
        ieNoOpen()
    - pattern: |
        helmet({ieNoOpen: ...})
  severity: WARNING
- id: helmet_header_nosniff
  languages:
  - javascript
  message: 'Content-Type-Options header is present. More information: https://helmetjs.github.io/docs/dont-sniff-mimetype/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {noSniff: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        helmet.noSniff()
    - pattern: |
        noSniff()
    - pattern: |
        helmet({noSniff: ...})
  severity: WARNING
- id: helmet_header_referrer_policy
  languages:
  - javascript
  message: 'Referrer-Policy header is present. More information: https://helmetjs.github.io/docs/referrer-policy/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {referrerPolicy: false}, ...)
  - pattern-either:
    - pattern: |
        helmet.referrerPolicy(...)
    - pattern: |
        referrerPolicy(...)
    - pattern: |
        helmet({referrerPolicy: ...})
  severity: WARNING
- id: helmet_header_xss_filter
  languages:
  - javascript
  message: 'X-XSS-Protection header is present. More information: https://helmetjs.github.io/docs/xss-filter/'
  metadata:
    category: security
    technology:
    - node.js
    - express
  patterns:
  - pattern-not: |
      $HELMET(..., {xssFilter: false}, ...)
  - pattern-either:
    - pattern: |
        $APP.use(helmet())
    - pattern: |
        helmet.xssFilter(...)
    - pattern: |
        xssFilter(...)
    - pattern: |
        helmet({xssFilter: ...})
  severity: WARNING
