rules:
  - id: jwt-exposed-credentials
    languages:
      - javascript
      - typescript
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      referrences: 
        - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_CheatSheet.html
      owasp:
        - A05:2021 - Security Misconfiguration
        - A06:2017 - Security Misconfiguration
      category: security
      technology:
        - jose
        - jwt
    message: >- 
      A hard-coded credential was detected. It is not recommended 
      to store credentials in source-code, as this risks secrets
      being leaked and used by either an internal or external malicious adversary. 
      It is recommended to use environment variables to 
      securely provide credentials or retrieve credentials from 
      a secure vault or HSM (Hardware Security Module).
    severity: WARNING
    mode: taint
    pattern-sources:
        - patterns:
            - pattern-either:
                - pattern: |
                    {...,password: '...',...}
    pattern-sinks:
        - patterns:
            - pattern-either:
                - pattern-inside: |
                    $JOSE = require("jose");
                    ...
                - pattern-inside: |
                    import $JOSE from 'jose'
                    ...
                - pattern-inside: |
                    import * as $JOSE from 'jose'
                    ...
                - pattern-inside: |
                    import {..., $JWT, ...} from 'jose'
                    ...
            - pattern-either:
                - patterns:
                    - pattern-either:
                        - pattern-inside: |
                            $JWT.sign(...);
                - patterns:
                    - pattern-inside: |
                        const { ..., $JWT, ... } = $JOSE
                        ...
                    - pattern-inside: $JWT.sign(...)
                    