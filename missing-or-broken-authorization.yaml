rules:
- id: missing-or-broken-authorization
  patterns:
  - pattern: "[AllowAnonymous]\npublic class $CLASS : Controller{\n    ...\n}\n"
  - pattern-inside: 'using Microsoft.AspNetCore.Mvc;

      ...

      '
  - pattern-not: "[Authorize]\npublic class $CLASS : Controller{\n    ...\n}\n"
  - pattern-not: "[Authorize(Roles = ...)]\npublic class $CLASS : Controller{\n  \
      \  ...\n}\n"
  - pattern-not: "[Authorize(Policy = ...)]\npublic class $CLASS : Controller{\n \
      \   ...\n}\n"
  message: Anonymous access shouldn't be allowed unless explicit by design. Access
    control checks are missing and potentially can be bypassed. This finding violates
    the principle of least privilege or deny by default, where access should only
    be permitted for a specific set of roles or conforms to a custom policy or users.
  metadata:
    category: security
    technology:
    - .net
    - mvc
    owasp:
    - "A01:2021 \u2013 Broken Access Control"
    cwe: 'CWE-862: Missing Authorization'
    references:
    - https://owasp.org/Top10/A01_2021-Broken_Access_Control
    - https://cwe.mitre.org/data/definitions/862.html
    - https://docs.microsoft.com/en-us/aspnet/core/security/authorization/simple?view=aspnetcore-7.0
  languages:
  - csharp
  severity: WARNING
