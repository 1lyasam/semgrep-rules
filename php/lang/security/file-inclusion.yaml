rules:
- id: file-inclusion
  languages:
  - php
  message: Detected non-constant file inclusion. This can lead to local file inclusion
    (LFI) or remote file inclusion (RFI) if user input reaches this statement. LFI
    and RFI could lead to sensitive files being obtained by attackers. Instead, explicitly
    specify what to include. If that is not a viable solution, validate user input
    thoroughly.
  metadata:
    category: security
    cwe: "CWE-16: Configuration"
    references:
    - https://www.php.net/manual/en/function.include.php
    - https://github.com/FloeDesignTechnologies/phpcs-security-audit/blob/master/Security/Sniffs/BadFunctions/EasyRFISniff.php
    - https://en.wikipedia.org/wiki/File_inclusion_vulnerability#Types_of_Inclusion
    technology:
    - php
  patterns:
  - pattern-inside: $FUNC(...);
  - pattern: $VAR
  - metavariable-regex:
      metavariable: $FUNC
      regex: \b(include|include_once|require|require_once)\b
  - metavariable-regex:
      metavariable: $VAR
      regex: \W?\$.+
  severity: ERROR
