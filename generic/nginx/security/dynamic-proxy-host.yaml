rules:
- id: dynamic-proxy-host
  languages:
  - generic
  message: The host for this proxy URL is dynamically determined. This can be dangerous
    if the host can be injected by an attacker because it may forcibly alter destination
    of the proxy. Consider hardcoding acceptable destinations and retrieving them
    with 'map' or something similar.
  metadata:
    category: security
    confidence: MEDIUM
    cwe: "CWE-16: Configuration"
    references:
    - https://nginx.org/en/docs/http/ngx_http_map_module.html
    source-rule-url: https://github.com/yandex/gixy/blob/master/docs/en/plugins/ssrf.md
    technology:
    - nginx
  paths:
    include:
    - '*.conf'
    - '*.vhost'
    - sites-available/*
    - sites-enabled/*
  pattern-either:
  - pattern: proxy_pass $SCHEME://$$HOST ...;
  - pattern: proxy_pass $$SCHEME://$$HOST ...;
  severity: WARNING
