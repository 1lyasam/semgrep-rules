rules:
- id: filepath-clean-misuse
  message: >-
    `Clean` is not intended to sanitize against path traversal attacks.
    This function is for finding the shortest path name equivalent to the given input.
    Using `Clean` to sanitize file reads may expose this application to
    path traversal attacks, where an attacker could access arbitrary files on the server.
    To fix this easily, prepend a slash ("/") at the beginning of the input, like this:
    `Clean("/"+...)`. However, a better solution is 
  severity: ERROR
  languages: [go]
  mode: taint
  pattern-sources:
  - pattern: "($REQUEST : *http.Request).$ANYTHING"
  pattern-sinks:
  - pattern-either:
    - pattern: filepath.Clean(...)
    - pattern: path.Clean(...)
  metadata:
    references:
    - https://pkg.go.dev/path#Clean
    - http://technosophos.com/2016/03/31/go-quickly-cleaning-filepaths.html
    - https://labs.detectify.com/2021/12/15/zero-day-path-traversal-grafana/
    cwe: 'CWE-22: Path Traversal'
    owasp:
    - 'A03:2021 - Injection'
    - 'A01:2017 - Injection'
    category: security
    technology:
    - go
