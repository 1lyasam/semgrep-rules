rules:
  - id: gorm-dangerous-method-usage
    message: >-
      Detected usage of dangerous method $METHOD which does not escape 
      inputs (see link in references). If the argument is user-controlled, 
      this can lead to SQL injection. 
      When using $METHOD function don't trust user-submitted data and only allow 
      approved list of input (possibly, use a whitelist approach).
    severity: WARNING
    languages:
      - go
    mode: taint
    pattern-sources:
      - pattern-either:
          - pattern: "($REQUEST : *http.Request).$ANYTHING"
          - pattern: "($REQUEST : http.Request).$ANYTHING"
    pattern-sinks:
      - patterns:
          - pattern-inside: |
              import ("gorm.io/gorm")
              ...
          - pattern: $DB.$METHOD(...)
          - metavariable-regex:
              metavariable: $METHOD
              regex: ^(Order|Exec|Raw|Group|Having|Distinct|Select|Pluck)$
    metadata:
      category: security
      technology:
        - gorm
      cwe: "CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')"
      owasp:
        - A03:2021 - Injection
      references:
        - https://gorm.io/docs/security.html#SQL-injection-Methods
      confidence: MEDIUM
