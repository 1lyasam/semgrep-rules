rules:
  - id: xml-reader-external-entity-expansion
    languages:
      - csharp
    message: XML External Entity (XXE) vulnerabilities occur when applications
      process untrusted XML data without disabling external entities and DTD
      processing. Processing untrusted XML data with a vulnerable parser can
      allow attackers to extract data from the server, perform denial of service
      attacks, and in some cases gain remote code execution.
    metadata:
      category: security
      cwe: "CWE-611: Improper Restriction of XML External Entity Reference"
      owasp:
        - A04:2017 - XML External Entities (XXE)
        - A05:2021 - Security Misconfiguration
      references:
        - https://www.owasp.org/index.php/Top_10-2017_A4-XML_External_Entities_(XXE)
        - https://www.jardinesoftware.net/2016/05/26/xxe-and-net/
        - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmlreadersettings.dtdprocessing
        - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmlreadersettings.prohibitdtd
        - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmltextreader.dtdprocessing
        - https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmltextreader.prohibitdtd
      source-rule-url: https://pumascan.com/rules/#sec0036-xml-reader
      technology:
        - .net
    mode: taint
    pattern-sources:
      - patterns:
          - pattern: |
              new XmlReaderSettings{...}
    pattern-sinks:
      - patterns:
          - pattern: |
              XmlReader.Create(...)
    pattern-sanitizers: 
      - pattern: |
          new XmlReaderSettings {
            ...,
            DtdProcessing = DtdProcessing.Prohibit,
            ...
          }
    severity: WARNING
