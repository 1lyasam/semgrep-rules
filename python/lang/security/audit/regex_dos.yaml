rules:
- id: regex_dos
  patterns:
  - pattern: |
      $A = re.compile("$B", ...)
      ...
      $A.$METHOD(...)
  - metavariable-analysis:
      analyzer: redos
      metavariable: $B
  - metavariable-regex:
      metavariable: $METHOD
      regex: (?!(escape)|(purge))
  message: >-
    Detected usage of re.compile with a call to escape or purge after.
    This can lead to regular expression denial of service, which can result
    in service down time. Instead, check all regexes or use safer alternatives
    such as pyre2.
  languages:
  - python
  severity: WARNING
  metadata:
    owasp: 'A6: Security Misconfiguration'
    cwe: 'CWE-185: Incorrect Regular Expression'
    category: security
    license: Commons Clause License Condition v1.0[LGPL-2.1-only]
    technology:
    - python
    references:
    - 'https://docs.python.org/3/library/re.html'
