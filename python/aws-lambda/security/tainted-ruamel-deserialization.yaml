rules:
  - id: tainted-ruamel-deserialization
    mode: taint
    pattern-sources:
    - patterns:
      - pattern: event
      - pattern-inside: |
          def $HANDLER(event, context):
            ...
    pattern-sinks:
    - patterns:
      - pattern: $SINK
      - pattern-either:
        - pattern-inside: ruamel.yaml.YAML($SINK,..., typ='unsafe', ...)
        - pattern-inside: ruamel.yaml.YAML($SINK,..., typ='base', ...)
    message: >-
      Avoid using `load()`. `PyYAML.load` can create arbitrary Python
      objects. A malicious actor could exploit this to run arbitrary
      code. Use `safe_load()` instead.
    metadata:
      owasp: "A8: Insecure Deserialization"
      cwe: "CWE-502: Deserialization of Untrusted Data"
      references:
      - https://pyyaml.org/wiki/PyYAMLDocumentation
      category: security
      technology:
        - python
        - yaml
        - aws-lambda
    languages:
      - python
    severity: WARNING
