rules:
  - id: rails-check-header-dos
    languages:
      - generic
    metadata:
      severity: WARNING
    patterns:
      - pattern-either:
          - patterns:
              - pattern-either:
                  - pattern: gem 'rails', '3.$A'
                  - pattern: gem 'rails', '~> 3.$A'
              - metavariable-comparison:
                  metavariable: $A
                  comparison: $A <= 2
          - patterns:
              - pattern-either:
                  - pattern: gem 'rails', '3.0.$B'
                  - pattern: gem 'rails', '~> 3.0.$B'
                  - pattern: gem 'rails', '3.1.$B'
                  - pattern: gem 'rails', '~> 3.1.$B'
          - patterns:
              - pattern-either:
                  - pattern: gem 'rails', '3.2.$C'
                  - pattern: gem 'rails', '~> 3.2.$C'
              - metavariable-comparison:
                  metavariable: $C
                  comparison: $C < 16
          - patterns:
              - pattern-either:
                  - pattern: gem 'rails', '4.0.$D'
                  - pattern: gem 'rails', '~> 4.0.$D'
              - metavariable-comparison:
                  metavariable: $D
                  comparison: $D == 0 or $D == 1
    message: Rails versions 3.0.0 - 3.2.15 and 4.0.0 and 4.0.1 are vulnerable to a DoS attack (CVE-2013-6414).
    severity: WARNING
    paths:
      include:
        - "Gemfile"
