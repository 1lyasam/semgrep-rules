rules:
- id: check-regex-dos
  mode: taint
  pattern-sources:
  - patterns:
    - pattern-either:
      - patterns:
        - pattern: $X
        - pattern-inside: |
            def $F(...,$X,...)
              ...
            end
      - patterns:
        - pattern: $X
        - pattern-inside: |
            params[...]
      - patterns:
        - pattern: $Y
        - pattern-inside: |
            $RECORD.$Y
  pattern-sinks:
  - patterns:
    - pattern-either:
      - patterns:
        - pattern: $Y
        - pattern-inside: |
            /...#{...}.../
      - patterns:
        - pattern: $Y
        - pattern-inside: |
            Regexp.new(...)
  message: Semgrep found a match
  languages:
  - ruby
  severity: ERROR
  metadata:
    source-rule-url: https://github.com/presidentbeef/brakeman/blob/main/lib/brakeman/checks/check_regex_dos.rb
    category: security
    cwe: 'CWE-1333: Inefficient Regular Expression Complexity'
    technology:
    - ruby
    - rails
    references:
    - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
